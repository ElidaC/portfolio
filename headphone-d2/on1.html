<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="https://use.typekit.net/sty5dnx.css">
  <link rel="stylesheet" href="style.css" />
  <title>Listening in Between</title>

  <style>
    body {
      background-image: url("bg/1-1.png");
      background-size: 100% auto;  
  background-repeat: no-repeat; 
  background-position: top center;
  background-attachment: scroll; 
    }

    .fade {
  position: fixed;
  bottom: 0;
  left: 0;
  width: 100%;
  height: 100%; 
  background: linear-gradient(
  to top,
  rgba(255, 255, 255, 1) 5%,
  rgba(255, 255, 255, 0) 30%
);
  pointer-events: none; 
    }

  .track-area {
  position: relative;   
  width: 100%;
  height: 300px;   
}

  .track-bar {
    position: absolute;
  background: #172d85;
  transition: height 0.1s linear;
  width: 80px;
  height: 200px;
  transform-origin: bottom; 
}

/* ä¸Šä¸‹åŠ¨çš„å…³é”®å¸§åŠ¨ç”» 
@keyframes track-bounce {
  0%   { transform: scaleY(0.5); }
  50%  { transform: scaleY(1.4); }
  100% { transform: scaleY(0.7); }
}
  */

  @keyframes track-bounce {
  0%   { transform: translateY(0); }
  50%  { transform: translateY(-50px); } /* å¾€ä¸Šè·³ä¸€ç‚¹ */
  100% { transform: translateY(0); }
}

/* æ’­æ”¾çŠ¶æ€ï¼šåŠ ä¸Šè¿™ä¸ªç±»å°±ä¼šåŠ¨ */
.track-bar.playing {
  animation: track-bounce 3s infinite ease-in-out;
}

.track-bar:nth-child(1).playing { animation-delay: 0s; }
.track-bar:nth-child(2).playing { animation-delay: -0.5s; }
.track-bar:nth-child(3).playing { animation-delay: -1s; }
.track-bar:nth-child(4).playing { animation-delay: -1.5s; }
.track-bar:nth-child(5).playing { animation-delay: -2s; }
.track-bar:nth-child(6).playing { animation-delay: -0s; }
.track-bar:nth-child(7).playing { animation-delay: -1.5s; }

/* ON / OFF æ–‡å­— */
.h-label {
  color: white !important;
}

/* æ•´æ¡è½¨é“å˜ç™½è‰² */
.h-track {
  background-color: white !important;
}

/* ä¸­é—´çš„æ»‘å—è¾¹æ¡†æˆ–èƒŒæ™¯ä¹Ÿè®¾æˆç™½è‰²ï¼Œå¦‚æœä½ æœ‰æ ·å¼ */
.h-thumb {
  background-color: white !important;
  border-color: black !important;
}

body { transition: filter 0.4s ease; backdrop-filter: blur(0px); }
  </style>

</head>



<body>

  <div class="fade"></div>
  <div class="h-axis"
       role="slider" aria-label="Power"
       aria-valuemin="0" aria-valuemax="1" aria-valuenow="0"
       tabindex="0">
    <span class="h-label" data-side="on">ON</span>
    <div class="h-track">
      <div class="h-thumb" data-position="on"></div>
    </div>
    <span class="h-label" data-side="off">OFF</span>
  </div>


  <div class="track-area">
    <div class="track-bar" style="left: 10%; top: 0;"></div>
    <div class="track-bar" style="left: 15%; top: 40%;"></div>
    <div class="track-bar" style="left: 20%; top: 20%;"></div>
    <div class="track-bar" style="left: 65%; top: -40%;"></div>
    <div class="track-bar" style="right: 5%; top: 220%;"></div>
  </div>


  <div class="mode-bar" role="group" aria-label="Listening Modes">
  <form>
    <label>
      <input data-sound="audio/1-1.mp3"
             data-bg="bg/1-1.png"
             onclick="playAudio(this)"
             type="radio" name="band" value="am" checked>
      <span>Default Mode</span>
    </label>
    
    <label>
      <input data-sound="audio/1-2.mp3"
             data-bg="bg/1-2.png"
             onclick="playAudio(this)"
             type="radio" name="band" value="fm">
      <span>Transparency</span>
    </label>
    
    <label>
      <input data-sound="audio/1-3.mp3"
             data-bg="bg/1-3.png"
             onclick="playAudio(this)"
             type="radio" name="band" value="mw">
      <span>Noise Cancellation</span>
    </label>
  </form>
</div>




  <script>

let currentAudio = null;

// æ§åˆ¶ track-bar æ˜¯å¦æ’­æ”¾åŠ¨ç”»
function setBarsPlaying(isPlaying) {
  const bars = document.querySelectorAll('.track-bar');
  bars.forEach(bar => {
    if (isPlaying) {
      bar.classList.add('playing');
    } else {
      bar.classList.remove('playing');
    }
  });
}

function playAudio(btn) {
  const src = btn.dataset.sound;
  const bg  = btn.dataset.bg;

  // åœæ­¢ä¸Šä¸€ä¸ªéŸ³é¢‘
  if (currentAudio) {
    currentAudio.pause();
    currentAudio.currentTime = 0;
  }

  // æ’­æ”¾æ–°çš„éŸ³é¢‘
  currentAudio = new Audio(src);
  currentAudio.play()
    .then(() => {
      // æ’­æ”¾æˆåŠŸï¼Œå¯åŠ¨æ–¹å—åŠ¨ç”»
      setBarsPlaying(true);
    })
    .catch(err => {
      console.error('æ’­æ”¾å¤±è´¥ï¼š', err);
      setBarsPlaying(false);
    });

  // åˆ‡æ¢èƒŒæ™¯å›¾
  if (bg) {
    document.body.style.backgroundImage = `url("${bg}")`;
  }

  // æ’­æ”¾ç»“æŸæ—¶åœæ‰åŠ¨ç”»
  currentAudio.addEventListener('ended', () => {
    setBarsPlaying(false);
  });
}



(() => {
  const clamp = (n, min, max) => Math.min(Math.max(n, min), max);
  const $ = (s, root = document) => root.querySelector(s);

  const hAxis  = $(".h-axis");
  const hTrack = $(".h-track");
  const hThumb = $(".h-thumb");
  if (!hAxis || !hTrack || !hThumb) return;

  // â€”â€” é¡µé¢è¯†åˆ«ï¼šon.html / off.html / å…¶å®ƒ â€”â€” //
  const path = (location.pathname || "").toLowerCase();
  const isOnPage  = /(^|\/)on\.html$/.test(path);
  const isOffPage = /(^|\/)off\.html$/.test(path);

  // â€”â€” ä½ç½®å·¥å…· â€”â€” //
  const pxToPercent = (clientX) => {
    const rect = hTrack.getBoundingClientRect();
    const x = clamp(clientX - rect.left, 0, rect.width);
    return (x / rect.width) * 100;
  };

  function setPos(percent, {updateAria=false} = {}) {
    percent = clamp(percent, 0, 100);
    hThumb.style.setProperty("--x", percent);
    if (updateAria) {
      // ON=0, OFF=1
      const ariaNow = percent <= 50 ? 0 : 1;
      hAxis.setAttribute("aria-valuenow", String(ariaNow));
    }
  }

  function snap(percent) {
    return percent <= 50 ? 0 : 100;
  }

  function navigateByPercent(percent) {
    const side = percent === 0 ? "on" : "off";
    if (side === "on") window.location.href = "on1.html";
    else window.location.href = "off1.html";
  }

  // â€”â€” åˆå§‹åŒ–ï¼šon.html åœ¨ ONï¼Œoff.html åœ¨ OFFï¼Œå…¶å®ƒæŒ‰ data-position â€”â€” //
  if (isOnPage) {
    setPos(0,   {updateAria:true});
  } else if (isOffPage) {
    setPos(100, {updateAria:true});
  } else {
    const init = (hThumb.dataset.position || "off").toLowerCase() === "on" ? 0 : 100;
    setPos(init, {updateAria:true});
  }

  // â€”â€” äº¤äº’ï¼šæ‹–æ‹½ â€”â€” //
  let dragging = false;
  let pointerId = null;

  const onMove = (e) => {
    if (!dragging) return;
    const clientX = (e.touches && e.touches[0]?.clientX) ?? e.clientX;
    setPos(pxToPercent(clientX), {updateAria:true});
  };

  const onUp = (e) => {
    if (!dragging) return;
    dragging = false;
    if (pointerId != null && hThumb.hasPointerCapture?.(pointerId)) {
      hThumb.releasePointerCapture(pointerId);
    }
    const clientX = (e.changedTouches && e.changedTouches[0]?.clientX) ?? e.clientX;
    const snapped = snap(pxToPercent(clientX));
    setPos(snapped, {updateAria:true});
    navigateByPercent(snapped);
    pointerId = null;
    // ç§»é™¤å…¨å±€ç›‘å¬
    window.removeEventListener("pointermove", onMove);
    window.removeEventListener("pointerup", onUp);
    window.removeEventListener("touchmove", onMove);
    window.removeEventListener("touchend", onUp);
  };

  // æ‹‡æŒ‡æŒ‰ä¸‹å¼€å§‹æ‹–æ‹½
  hThumb.addEventListener("pointerdown", (e) => {
    e.preventDefault();
    dragging = true;
    pointerId = e.pointerId;
    hThumb.setPointerCapture?.(pointerId);
    window.addEventListener("pointermove", onMove);
    window.addEventListener("pointerup", onUp);
  });

  // è§¦æ§æ”¯æŒ
  hThumb.addEventListener("touchstart", (e) => {
    dragging = true;
    window.addEventListener("touchmove", onMove, {passive:false});
    window.addEventListener("touchend", onUp);
  }, {passive:true});

  // â€”â€” ç‚¹å‡»è½¨é“ç›´æ¥å¸é™„å¹¶è·³è½¬ â€”â€” //
  hTrack.addEventListener("pointerdown", (e) => {
    if (e.target === hThumb) return; // å·²ç”±æ‹‡æŒ‡å¤„ç†
    const p = pxToPercent(e.clientX);
    const snapped = snap(p);
    setPos(snapped, {updateAria:true});
    navigateByPercent(snapped);
  });

  // â€”â€” ç‚¹å‡» ON/OFF æ–‡æœ¬ â€”â€” //
  document.querySelectorAll(".h-label").forEach(lbl => {
    lbl.addEventListener("click", () => {
      const text = (lbl.textContent || "").trim().toLowerCase();
      if (text === "on")  { setPos(0,   {updateAria:true}); navigateByPercent(0); }
      if (text === "off") { setPos(100, {updateAria:true}); navigateByPercent(100); }
    });
  });

  // â€”â€” é”®ç›˜ï¼šåœ¨ .h-axis ä¸Š â€”â€” //
  hAxis.addEventListener("keydown", (e) => {
    const k = e.key;
    const curr = parseFloat(getComputedStyle(hThumb).getPropertyValue("--x")) || 0;

    if (k === "ArrowLeft")  { e.preventDefault(); setPos(curr - 5, {updateAria:true}); }
    if (k === "ArrowRight") { e.preventDefault(); setPos(curr + 5, {updateAria:true}); }
    if (k === "Home")       { e.preventDefault(); setPos(0,   {updateAria:true}); }
    if (k === "End")        { e.preventDefault(); setPos(100, {updateAria:true}); }

    if (k === "Enter" || k === " ") {
      e.preventDefault();
      const snapped = snap(curr);
      setPos(snapped, {updateAria:true});
      navigateByPercent(snapped);
    }
  });
})();

axis.querySelectorAll('.h-label').forEach(label => {
  label.addEventListener('click', () => {
    const t = label.dataset.target;
    if (t === 'on')  setPositionByIndex(0);
    if (t === 'off') setPositionByIndex(2);
  });
});







/*
const onLabel = document.querySelectorAll('.h-label')[0];  // ON
const offLabel = document.querySelectorAll('.h-label')[1]; // OFF

// å®æ—¶ç›‘å¬é¼ æ ‡
document.addEventListener("mousemove", (e) => {
    const onRect = onLabel.getBoundingClientRect();
    const offRect = offLabel.getBoundingClientRect();

    // é¼ æ ‡è·ç¦» ON / OFF çš„æ°´å¹³è·ç¦»
    const distToOn = Math.abs(e.clientX - (onRect.left + onRect.width / 2));
    const distToOff = Math.abs(e.clientX - (offRect.left + offRect.width / 2));

    // æ ¹æ®è·ç¦»è®¡ç®—æ¨¡ç³Šç¨‹åº¦ï¼ˆè¶Šé è¿‘ ON è¶Šæ¨¡ç³Šï¼‰
    // ğŸ”¥ ä½ å¯è°ƒæœ€å¤§æ¨¡ç³Šå€¼ 12 â†’ å¯æ”¹æˆ 20/30/5 çœ‹ä½ æƒ³å¤šç³Š
    let blurStrength = Math.max(0, 12 - distToOn / 20); 

    // è¶Šé è¿‘ OFF è¶Šæ¸…æ™° â†’ bluré™ä½
    blurStrength -= Math.max(0, 8 - distToOff / 18);

    // é™åˆ¶æœ€å°ä¸ä¸ºè´Ÿæ•°
    blurStrength = Math.max(0, blurStrength);

    document.body.style.filter = `blur(${blurStrength}px)`;
});
*/
  </script>
</body>
</html>